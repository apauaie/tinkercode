function runJS(){var code=Blockly.Generator.workspaceToCode("JavaScript");try{eval(code)}catch(e){alert("Program error:\n"+e)}}function backup_blocks(){if("localStorage"in window){var e=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);window.localStorage.setItem("arduino",Blockly.Xml.domToText(e))}}function restore_blocks(){if("localStorage"in window&&window.localStorage.arduino){var e=Blockly.Xml.textToDom(window.localStorage.arduino);Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,e)}}function saveCode(){var e=window.prompt("What would you like to name your file?","BlocklyDuino");if(e){var o=new Blob([Blockly.Arduino.workspaceToCode()],{type:"text/plain;charset=utf-8"});saveAs(o,e+".ino")}}function save(){var e=Blockly.Xml.workspaceToDom(Blockly.mainWorkspace),o=Blockly.Xml.domToText(e),t=window.prompt("What would you like to name your file?","BlocklyDuino");if(t){var n=new Blob([o],{type:"text/xml"});saveAs(n,t+".xml")}}function load(e){var o=e.target.files;if(1==o.length){var t=new FileReader;t.onloadend=function(e){var o=e.target;if(2==o.readyState){try{var t=Blockly.Xml.textToDom(o.result)}catch(e){return void alert("Error parsing XML:\n"+e)}Blockly.mainWorkspace.getAllBlocks().length&&confirm('Replace existing blocks?\n"Cancel" will merge.')&&Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,t)}document.getElementById("load").value=""},t.readAsText(o[0])}}function discard(){var e=Blockly.mainWorkspace.getAllBlocks().length;(e<2||window.confirm("Delete all "+e+" blocks?"))&&(Blockly.mainWorkspace.clear(),renderContent())}function auto_save_and_restore_blocks(){window.setTimeout(restore_blocks,0),bindEvent(window,"unload",backup_blocks),tabClick(selected);var e=document.getElementById("load");e.addEventListener("change",load,!1),document.getElementById("fakeload").onclick=function(){e.click()}}function bindEvent(e,o,t){e.addEventListener?e.addEventListener(o,t,!1):e.attachEvent&&e.attachEvent("on"+o,t)}var ajax;function createAJAX(){if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:null;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}}function onSuccess(){if(4==ajax.readyState)if(200==ajax.status){try{var e=Blockly.Xml.textToDom(ajax.responseText)}catch(e){return void alert("Error parsing XML:\n"+e)}Blockly.mainWorkspace.getAllBlocks().length&&confirm('Replace existing blocks?\n"Cancel" will merge.')&&Blockly.mainWorkspace.clear(),Blockly.Xml.domToWorkspace(Blockly.mainWorkspace,e)}else alert("Server error")}function load_by_url(e){if(!(ajax=createAJAX()))return alert("Not compatible with XMLHttpRequest"),0;ajax.overrideMimeType&&ajax.overrideMimeType("text/xml"),ajax.onreadystatechange=onSuccess,ajax.open("GET",e,!0),ajax.send("")}function uploadCode(e){swal({type:"info",text:"Uploading almost done!",title:"Hang on tight...",showConfirmButton:!1,timer:1500});var o=document.getElementById("content_arduino"),r=(new Spinner).spin(o),a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState){r.stop();var e=parseInt(a.status),o=null,t=null,n=null;switch(e){case 200:o="Awesome",t="You're all set. Let's try your program",n="success",confirm=!1,timer=2e3;break;case 0:o="Error Uploading Program",t="1. Make sure the server is started\n2. Make sure the board type and port chosen are correct\n3. Make sure the board is connected",n="error",confirm=!0,timer=1e4;break;case 400:o="Error Uploading Program",t="code 400\n\nBuild failed - probably due to invalid source code.  Make sure that there are no missing connections in the blocks.",n="error",confirm=!0,timer=1e4;break;case 500:o="Error Uploading Program",t="code 500\n\nUpload failed.  Is the Arduino connected to USB port?",n="error",confirm=!0,timer=1e4;break;case 501:o="Error Uploading Program",t="code 501\n\nUpload failed.  Is 'ino' installed and in your path?  This only works on Mac OS X and Linux at this time.",n="error",confirm=!0,timer=1e4;break;default:o="Unknown Error",t="code "+e+"\n\nUnknown error.",n="error",confirm=!1,timer=1e4}swal({type:n,text:t,title:o,showConfirmButton:confirm,timer:timer})}},a.open("POST","http://127.0.0.1:5005",!0),a.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),a.send(JSON.stringify(e))}function emptyOptions(e){for(var o=e.options.length-1;0<=o;o--)e.remove(o)}function populateSetting(){for(var e=window.location.href,o=new URL(e),t=o.searchParams.get("board"),a=o.searchParams.get("port"),n=document.getElementById("board"),r=0;i=n.options[r];r++)if(i.value==t){n.selectedIndex=r;break}var i,l=document.getElementById("port");for(r=0;i=l.options[r];r++)if(i.value==a){l.selectedIndex=r;break}$.ajax({type:"GET",url:"http://127.0.0.1:5005/ports.xml",dataType:"xml",success:function(e){var r=document.getElementById("port");emptyOptions(r);var o=e.getElementsByTagName("serial");$.each(o,function(e,o){var t=o.childNodes[0].textContent,n=(o.childNodes[1].textContent,document.createElement("option"));n.text=t,(n.value=t)==a&&(n.selected=!0),r.options.add(n)})}})}function updateSetting(){var e=window.location.search;document.getElementById("board"),document.getElementById("port");e="?lang="+$("#languageMenu option:selected").val()+"&board="+$("#board option:selected").val()+"&port="+$("#port option:selected").val(),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname+e}function uploadPayload(){var e=Blockly.Arduino.workspaceToCode(),o=window.location.href,t=new URL(o),n=t.searchParams.get("board"),r=t.searchParams.get("port");if(""==n)swal("Empty Board Type","Please choose a board type in Settings","error");else if(""==r)swal("Empty Port","Please choose a port in Settings","error");else{uploadCode({code:e,board:n,port:r})}}function resetClick(){uploadCode("void setup() {} void loop() {}")}!function(e,o){"object"==typeof exports?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Spinner=o()}(this,function(){"use strict";var h,a=["webkit","Moz","ms","O"],y={};function v(e,o){var t,n=document.createElement(e||"div");for(t in o)n[t]=o[t];return n}function w(e){for(var o=1,t=arguments.length;o<t;o++)e.appendChild(arguments[o]);return e}var e,g=(e=v("style",{type:"text/css"}),w(document.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet);function n(e,o){var t,n,r=e.style;for(o=o.charAt(0).toUpperCase()+o.slice(1),n=0;n<a.length;n++)if(void 0!==r[t=a[n]+o])return t;if(void 0!==r[o])return o}function k(e,o){for(var t in o)e.style[n(e,t)||t]=o[t];return e}function o(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var n in t)void 0===e[n]&&(e[n]=t[n])}return e}function x(e,o){return"string"==typeof e?e:e[o%e.length]}var t={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};function r(e){this.opts=o(e||{},r.defaults,t)}r.defaults={},o(r.prototype,{spin:function(e){this.stop();var t=this,n=t.opts,r=t.el=k(v(0,{className:n.className}),{position:n.position,width:0,zIndex:n.zIndex});if(k(r,{left:n.left,top:n.top}),e&&e.insertBefore(r,e.firstChild||null),r.setAttribute("role","progressbar"),t.lines(r,t.opts),!h){var a,i=0,l=(n.lines-1)*(1-n.direction)/2,c=n.fps,s=c/n.speed,d=(1-n.opacity)/(s*n.trail/100),p=s/n.lines;!function e(){i++;for(var o=0;o<n.lines;o++)a=Math.max(1-(i+(n.lines-o)*p)%s*d,n.opacity),t.opacity(r,o*n.direction+l,a,n);t.timeout=t.el&&setTimeout(e,~~(1e3/c))}()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(e,t){var o,n,r,a,i,l,c,s,d,p,u=0,m=(t.lines-1)*(1-t.direction)/2;function f(e,o){return k(v(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:o,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*u+t.rotate)+"deg) translate("+t.radius+"px,0)",borderRadius:(t.corners*t.width>>1)+"px"})}for(;u<t.lines;u++)o=k(v(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:h&&(n=t.opacity,r=t.trail,a=m+u*t.direction,i=t.lines,void 0,void 0,void 0,void 0,void 0,l=["opacity",r,~~(100*n),a,i].join("-"),c=.01+a/i*100,s=Math.max(1-(1-n)/r*(100-c),n),d=h.substring(0,h.indexOf("Animation")).toLowerCase(),p=d&&"-"+d+"-"||"",y[l]||(g.insertRule("@"+p+"keyframes "+l+"{0%{opacity:"+s+"}"+c+"%{opacity:"+n+"}"+(c+.01)+"%{opacity:1}"+(c+r)%100+"%{opacity:"+n+"}100%{opacity:"+s+"}}",g.cssRules.length),y[l]=1),l+" "+1/t.speed+"s linear infinite")}),t.shadow&&w(o,k(f("#000","0 0 4px #000"),{top:"2px"})),w(e,w(o,f(x(t.color,u),"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,o,t){o<e.childNodes.length&&(e.childNodes[o].style.opacity=t)}});var i=k(v("group"),{behavior:"url(#default#VML)"});return!n(i,"transform")&&i.adj?function(){function s(e,o){return v("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',o)}g.addRule(".spin-vml","behavior:url(#default#VML)"),r.prototype.lines=function(e,n){var r=n.length+n.width,o=2*r;function a(){return k(s("group",{coordsize:o+" "+o,coordorigin:-r+" "+-r}),{width:o,height:o})}var t,i=2*-(n.width+n.length)+"px",l=k(a(),{position:"absolute",top:i,left:i});function c(e,o,t){w(l,w(k(a(),{rotation:360/n.lines*e+"deg",left:~~o}),w(k(s("roundrect",{arcsize:n.corners}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:t}),s("fill",{color:x(n.color,e),opacity:n.opacity}),s("stroke",{opacity:0}))))}if(n.shadow)for(t=1;t<=n.lines;t++)c(t,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(t=1;t<=n.lines;t++)c(t);return w(e,l)},r.prototype.opacity=function(e,o,t,n){var r=e.firstChild;n=n.shadow&&n.lines||0,r&&o+n<r.childNodes.length&&(r=(r=(r=r.childNodes[o+n])&&r.firstChild)&&r.firstChild)&&(r.opacity=t)}}():h=n(i,"animation"),r});